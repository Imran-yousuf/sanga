$(function(){$.createAutocompleters("hForm",{baseUrl:$.sanga.baseUrl}),$("#date").datepicker({beforeShow:function(e,t){window.navigator.userAgent.search(/Firefox/)&&t.dpDiv.css({top:220+e.offsetHeight+"px"})}}),$("#xcontact-id").autocomplete({minLength:2,html:!0,source:$.sanga.baseUrl+"/Contacts/search",focus:function(){return!1},select:function(e,t){return this.value=t.item.label.replace(/(<([^>]+)>)/gi,""),$("#contact-id").val(t.item.value),!1},change:function(e,t){return this.value=t.item.label.replace(/(<([^>]+)>)/gi,""),$("#contact-id").val(t.item.value),!1}}),$("#xgroup-id").autocomplete({minLength:2,html:!0,source:$.sanga.baseUrl+"/Groups/search",focus:function(){return!1},select:function(e,t){return this.value=t.item.label.replace(/(<([^>]+)>)/gi,""),$("#group-id").val(t.item.value),!1},change:function(e,t){return this.value=t.item.label.replace(/(<([^>]+)>)/gi,""),$("#group-id").val(t.item.value),!1}}),$("#xevent-id").autocomplete({minLength:2,html:!0,source:$.sanga.baseUrl+"/Events/search",focus:function(){return!1},select:function(e,t){return this.value=t.item.label.replace(/(<([^>]+)>)/gi,""),$("#event-id").val(t.item.value),!1},change:function(e,t){return this.value=t.item.label.replace(/(<([^>]+)>)/gi,""),$("#event-id").val(t.item.value),!1}}),$("#hsave").click(function(e){var t=$("#hInfo");t.append($("#ajaxloader").show()),$("#hsave").hide();var a={contact_id:$("#contact-id").val(),date:$("#date").val(),group_id:$("#group-id").val(),event_id:$("#event-id").val(),detail:$("#detail").val(),target_group_id:$("#target-group-id").val(),family:null};return $("#quantity").val()&&(a.quantity=$("#quantity").val(),a.unit_id=$("#unit-id").val()),$.ajax({url:$("#hForm").attr("action"),data:a,type:"post",dataType:"json",error:function(e,t,a){$("#ajaxloader").hide(),noty({text:t,type:"error",animation:$.sanga.animation}),$("#hsave").show()},success:function(e,t,a){$("#ajaxloader").hide(),noty({text:a.responseJSON.errors?a.responseJSON.message+" "+a.responseJSON.errors:a.responseJSON.message,type:a.responseJSON.success?"success":"error",animation:$.sanga.animation,buttons:!1,timeout:2});var n=$("<tr>"),i="";-1!=location.pathname.search(/histories/i)?i+='<td><a href="'+$.sanga.baseUrl+"/contacts/view/"+$("#contact-id").val()+'">'+$("#xcontact-id").val()+"</a></td>":i+="<td></td>",i+="<td>"+$("#date").val()+"</td>",i+="<td>"+$("#uName").text()+"</td>",i+="<td>"+$("#ac-group-id").val()+"</td>",i+="<td>"+$("#ac-event-id").val()+"</td>",i+="<td>"+$("#detail").val()+"</td>",i+='<td class="r">',$("#quantity").val()&&(i+=$("#quantity").val()+"  Ft"),i+="</td>",i+="<td></td>",n.append(i),$("#hTable > tbody").children("tr:first").after(n),$("#hForm :input").not(".dontdel").val(""),$("#hsave").show()}}),e.preventDefault(),!1})});