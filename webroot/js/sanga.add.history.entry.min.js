$(function(){$("#date").datepicker();$("#xcontact-id").autocomplete({minLength:2,html:true,source:$.sanga.baseUrl+"/Contacts/search",focus:function(){return false},select:function(a,b){this.value=b.item.label.replace(/(<([^>]+)>)/ig,"");$("#contact-id").val(b.item.value);return false},change:function(a,b){this.value=b.item.label.replace(/(<([^>]+)>)/ig,"");$("#contact-id").val(b.item.value);return false}});$("#xgroup-id").autocomplete({minLength:2,html:true,source:$.sanga.baseUrl+"/Groups/search",focus:function(){return false},select:function(a,b){this.value=b.item.label.replace(/(<([^>]+)>)/ig,"");$("#group-id").val(b.item.value);return false},change:function(a,b){this.value=b.item.label.replace(/(<([^>]+)>)/ig,"");$("#group-id").val(b.item.value);return false}});$("#xevent-id").autocomplete({minLength:2,html:true,source:$.sanga.baseUrl+"/Events/search",focus:function(){return false},select:function(a,b){this.value=b.item.label.replace(/(<([^>]+)>)/ig,"");$("#event-id").val(b.item.value);return false},change:function(a,b){this.value=b.item.label.replace(/(<([^>]+)>)/ig,"");$("#event-id").val(b.item.value);return false}});$("#hsave").click(function(b){var a=$("#hInfo");a.append($("#ajaxloader").show());$("#hsave").hide();var c={contact_id:$("#contact-id").val(),date:$("#date").val(),group_id:$("#group-id").val(),event_id:$("#event-id").val(),detail:$("#detail").val(),target_group_id:$("#target-group-id").val(),family:null};if($("#quantity").val()){c.quantity=$("#quantity").val();c.unit_id=$("#unit-id").val()}$.ajax({url:$("#hForm").attr("action"),data:c,type:"post",dataType:"json",error:function(d,f,e){$("#ajaxloader").hide();noty({text:f,type:"error",animation:$.sanga.animation});$("#hsave").show()},success:function(f,h,e){$("#ajaxloader").hide();noty({text:e.responseJSON.errors?(e.responseJSON.message+" "+e.responseJSON.errors):e.responseJSON.message,type:e.responseJSON.success?"success":"error",animation:$.sanga.animation,buttons:false,timeout:2});var d=$("<tr>");var g="";if(location.pathname.search(/histories/i)!=-1){g+='<td><a href="'+$.sanga.baseUrl+"/contacts/view/"+$("#contact-id").val()+'">'+$("#xcontact-id").val()+"</a></td>"}else{g+="<td></td>"}g+="<td>"+$("#date").val()+"</td>";g+="<td>"+$("#uName").text()+"</td>";g+="<td>"+$("#xgroup-id").val()+"</td>";g+="<td>"+$("#xevent-id").val()+"</td>";g+="<td>"+$("#detail").val()+"</td>";g+='<td class="r">';if($("#quantity").val()){g+=$("#quantity").val()+"  Ft"}g+="</td>";g+="<td></td>";d.append(g);$("#hTable > tbody").children("tr:first").after(d);$("#hForm :input").not(".dontdel").val("");$("#hsave").show()}});b.preventDefault();return false})});