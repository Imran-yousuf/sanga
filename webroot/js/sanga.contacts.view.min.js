$(function(){$.createAutocompleters("editForm",{baseUrl:$.sanga.baseUrl,onlyExistingValue:!1}),$(".editbox").hide();var e=$.localStorage("sanga.userViewActiveTab")?$.localStorage("sanga.userViewActiveTab"):0;$("#tabs").tabs({active:e}).addClass("ui-tabs-vertical ui-helper-clearfix"),$("#tabs li").removeClass("ui-corner-top").addClass("ui-corner-left"),$(window).on("beforeunload",function(){var e=$(".ui-tabs-active")[0].id.replace(/tabnav-/,"");$.localStorage("sanga",{userViewActiveTab:parseInt(e)-1})}),$(".draggable").draggable({revert:"invalid",opacity:.7,zIndex:100}),$("#notfamilymember").droppable({over:function(e,a){$(this).addClass("highlight"),$(this).children("div").addClass("delete-open").removeClass("delete-close")},out:function(e,a){$(this).removeClass("highlight"),$(this).children("div").addClass("delete-close").removeClass("delete-open")},drop:function(e,a){var t=$(a.draggable).find("a");t=$(t[0]),$.ajax({url:t.attr("href").replace(/view\/(\d+)/,"remove_family/$1"),type:"get",dataType:"json",error:function(e,a,t){alert(e.responseJSON.message)},success:function(t,s,i){a.draggable.hide(),$(e.target).removeClass("highlight")}})}}),$("#member").droppable({accept:".notmember",over:function(e,a){$(this).addClass("highlight")},out:function(e,a){$(this).removeClass("highlight")},drop:function(e,a){$.ajax({url:$(location).attr("href").replace(/view\/(\d+)/,"editgroup/$1"),data:{"groups[_ids][]":[a.draggable.data("id")]},type:"post",dataType:"json",error:function(e,a,t){alert(a)},success:function(t,s,i){var r=a.draggable;r.appendTo(e.target),r.attr("style","position:relative"),r.removeClass("tag-default notmember"),r.addClass("member"),r.addClass(a.draggable.data("css")),$(e.target).removeClass("highlight")}})}}),$("#notmember").droppable({accept:".member",over:function(e,a){$(this).addClass("highlight")},out:function(e,a){$(this).removeClass("highlight")},drop:function(e,a){$.ajax({url:$(location).attr("href").replace(/view\/(\d+)/,"removegroup/$1"),data:{group_id:[a.draggable.data("id")]},type:"post",dataType:"json",error:function(e,a,t){alert(a)},success:function(t,s,i){var r=a.draggable;r.appendTo(e.target),r.attr("style","position:relative"),r.removeClass(a.draggable.data("css")),r.removeClass("member"),r.addClass("tag-default notmember"),$(e.target).removeClass("highlight")}})}}),$("p.ed").hover(function(){$(this).find("#ajaxsave").length?$("#editlink").hide():$(this).append($("#editlink").show())},function(){$("#editlink").hide()}),$(document).on("click",".removeable",function(){$.ajax({url:$.sanga.baseUrl+"/Contacts/removeSkill",data:{contact_id:$("#contact-id").val(),skill_id:$(this).data("id")},type:"post",dataType:"json",error:function(e,a,t){noty({text:a,type:"error",timeout:3500}),theSpan.text(oldData)},success:function(e,a,t){noty({text:a+" "+t.responseJSON.message,type:"success",timeout:3500})}})});var a=function(e){$("#editlink").hide(),$(e.target).parent().append($("#ajaxsave").show()),e.keyCode==$.ui.keyCode.ESCAPE&&($(e.target).hide(),$(e.target).parent().find(".dta").show(),$("#ajaxsave").hide())};$("#editForm").submit(function(e){e.preventDefault()}),$(".editbox").focus(function(e){a(e)}),$("#ajaxsave").click(function(e){var a,t,s=$(this).parent().find(".editbox"),i={},r={};s.each(function(e){var s,o=$(this);if(o.is("label"))return!0;-1!=o.attr("class").search(/zip/)?-1!=o.attr("id").search(/workplace/)?(a=o.parent().find(".workplace_zip-zip"),s=$("#xworkplace-zip").val(),i.workplace_zip_id=$("#workplace-zip-id").val()):(a=o.parent().find(".zip-zip"),s=$("#xzip").val(),i.zip_id=$("#zip-id").val()):-1!=o.attr("class").search(/family/)?(a=o.parent().find(".dta"),i.family_member_id=$("#family-member-id").val(),t=$("#xfamily").val()):-1!=o.attr("class").search(/addr/)?-1!=o.attr("id").search(/workplace/)?(a=o.parent().find(".workplace_address"),s=i.workplace_address=$("#workplace-address").val()):(a=o.parent().find(".address"),s=i.address=$("#address").val()):"skills"==o.attr("id")?(a=o.parent().find(".dta"),i["skills[_ids][]"]=[],$('[name="skills\\[\\][id]"]').each(function(){i["skills[_ids][]"].push($(this).val())})):(a=o.parent().find(".dta"),o.is(":checkbox")?s=+o.is(":checked"):o.is(":radio")?o.is(":checked")&&(i[o.attr("name")]=o.val(),s=$('label[for="'+o.attr("id")+'"]').text()):s=o.val(),void 0!==s&&void 0!==o.attr("name")&&void 0===i[o.attr("name")]&&(i[o.attr("name")]=s)),r[o.attr("name")]=a.text(),void 0!==s&&(-1!=s.search(/\n/)?a.html(s.replace(/</,"&lt;").replace(/\n/g,"<br>")):a.text(s)),a.show()}),$("#editlink").hide();var o=$(s[0]).parent();o.append($("#ajaxloader").show()),$("#ajaxsave").hide(),$.ajax({url:$("#editForm").attr("action"),data:i,type:"post",dataType:"json",error:function(e,t,s){$("#ajaxloader").hide(),o.append($("#errorImg").show()),noty({text:t+(e.responseJSON.message?": "+e.responseJSON.message:""),type:"error",timeout:3500}),a.text(r[this.data.substr(0,this.data.indexOf("="))])},success:function(e,a,s){$("#ajaxloader").hide(),noty({text:s.responseJSON.message,type:"success",timeout:3500}),t&&o.append('<span class="tag tag-viewable draggable">'+t+"</span> ")}}),s.hide(),e.preventDefault()}),$("#editlink").click(function(e){$(".editbox").hide(),$(".dta").show(),$(this).parent().find(".editbox").show(),$(this).parent().find(".dta").hide(),$("#ajaxsave").hide(),e.preventDefault()}),$("#gSave").click(function(e){var a=$(this);a.append($("#ajaxloader").css("float","none").show()),$.ajax({url:$(this).attr("href"),type:"get",dataType:"json",error:function(e,t,s){$("#ajaxloader").hide(),a.append($("#errorImg").css("float","none").show())},success:function(e,t,s){$("#ajaxloader").hide(),a.append($("#okImg").css("float","none").show().hide(12500));var i=$("#gImg").attr("src");$("#gImg").attr("src",i.replace(/-inactive/,""))}}),e.preventDefault()}),$("#sendmail").click(function(e){var a=$(this).parent();a.append($("#ajaxloader").css("float","none").show()),$.ajax({url:$.sanga.baseUrl+"/Contacts/sendmail",type:"post",data:{subject:$("#subject").val(),message:$("#message").val()},dataType:"json",error:function(e,t,s){$("#ajaxloader").hide(),a.append($("#errorImg").css("float","none").show())},success:function(e,t,s){$("#ajaxloader").hide(),a.append($("#okImg").css("float","none").show().hide(12500));var i=$("#gImg").attr("src");$("#gImg").attr("src",i.replace(/-inactive/,"")),$("#subject").val(""),$("#message").val("")}})}),$("#dialog").dialog({autoOpen:!1,closeText:"âŠ—",position:{of:$("#settings"),my:"top+20",at:"right+300"},width:"600",show:{effect:"slideDown"},hide:{effect:"slideUp"}}),$("#settings").click(function(){$("#dialog").dialog("open")}),$("#settingsForm").submit(function(e){e.preventDefault(),$.ajax({url:$.sanga.baseUrl+"/Settings/edit",data:$("#settingsForm").serialize(),type:"post",dataType:"json",error:function(e,a,t){noty({text:a,type:"error",timeout:3500})},success:function(e,a,t){noty({text:t.responseJSON.message,type:"success",timeout:3500}),location.reload()}})})});